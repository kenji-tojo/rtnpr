//
// Created by Nobuyuki Umetani on 2021/12/11.
//

#ifndef DFM2_QUADRATURE_H_
#define DFM2_QUADRATURE_H_

#include <array>

namespace delfem2 {

constexpr static unsigned int kNumIntegrationPoint_GaussianQuadrature[9] = {
  0, 1, 3, 6, 10, 15, 21, 28
};

/**
 * position and weight of Gaussian integration quadrature
 * @tparam T float or double
 * https://pomax.github.io/bezierinfo/legendre-gauss.html
 */
template<typename T>
constexpr static T kPositionWeight_GaussianQuadrature[28][2] = {
  // 1 point
  {0.0, 2.0},
  // 2 points [1-3]
  {-0.577350269189626, 1.0},
  {0.577350269189626, 1.0},
  // 3 points [3-6]
  {+0.000000000000000, 0.888888888888889},
  {-0.774596669241483, 0.555555555555556},
  {+0.774596669241483, 0.555555555555556},
  // 4 points [6-10]
  {-0.861136311594053, 0.347854845137454},
  {+0.861136311594053, 0.347854845137454},
  {-0.339981043584856, 0.652145154862546},
  {+0.339981043584856, 0.652145154862546},
  // 5 points [10-15]
  {+0.0000000000000000, 0.5688888888888889},
  {-0.5384693101056831, 0.4786286704993665},
  {+0.5384693101056831, 0.4786286704993665},
  {-0.9061798459386640, 0.2369268850561891},
  {+0.9061798459386640, 0.2369268850561891},
  // 6 points [15-21]
  {+0.6612093864662645, 0.3607615730481386},
  {-0.6612093864662645, 0.3607615730481386},
  {-0.2386191860831969, 0.4679139345726910},
  {+0.2386191860831969, 0.4679139345726910},
  {-0.9324695142031521, 0.1713244923791704},
  {+0.9324695142031521, 0.1713244923791704},
  // 7 points [21-28]
  {+0.00000000000000000e+00, 4.17959183673469388e-01},
  {-4.05845151377397167e-01, 3.81830050505118945e-01},
  {+4.05845151377397167e-01, 3.81830050505118945e-01},
  {-7.41531185599394440e-01, 2.79705391489276668e-01},
  {+7.41531185599394440e-01, 2.79705391489276668e-01},
  {-9.49107912342758525e-01, 1.29484966168869693e-01},
  {+9.49107912342758525e-01, 1.29484966168869693e-01},
};

/**
 * Typically used together with 7 point Gaussian quadrature
 * https://en.wikipedia.org/wiki/Gauss%E2%80%93Kronrod_quadrature_formula
 * @tparam T
 */
template<typename T>
constexpr static T kPositionWeight_GaussKronrodQuadrature[15][2] = {
  {+0.00000000000000000e+00, 2.09482141084727828e-01},
  {-4.05845151377397167e-01, 1.90350578064785410e-01},
  {+4.05845151377397167e-01, 1.90350578064785410e-01},
  {-7.41531185599394440e-01, 1.40653259715525919e-01},
  {+7.41531185599394440e-01, 1.40653259715525919e-01},
  {-9.49107912342758525e-01, 6.30920926299785533e-02},
  {+9.49107912342758525e-01, 6.30920926299785533e-02},
  // shared position with Gauss7 up to here
  {+2.07784955007898468e-01, 2.04432940075298892e-01},
  {+5.86087235467691130e-01, 1.69004726639267903e-01},
  {+8.64864423359769073e-01, 1.04790010322250184e-01},
  {+9.91455371120812639e-01, 2.29353220105292250e-02},
  {-2.07784955007898468e-01, 2.04432940075298892e-01},
  {-5.86087235467691130e-01, 1.69004726639267903e-01},
  {-8.64864423359769073e-01, 1.04790010322250184e-01},
  {-9.91455371120812639e-01, 2.29353220105292250e-02},
};

// ============================

constexpr static unsigned int NIntTriGauss[3] = {1, 3, 7};

template<typename T>
constexpr static T TriGauss[3][7][3] =
  {
    { // liner
      {0.3333333333, 0.3333333333, 1.0},
      {0.0, 0.0, 0.0},
      {0.0, 0.0, 0.0},
      {0.0, 0.0, 0.0},
      {0.0, 0.0, 0.0},
      {0.0, 0.0, 0.0},
    },
    { // quadratic
      {0.1666666667, 0.1666666667, 0.3333333333},
      {0.6666666667, 0.1666666667, 0.3333333333},
      {0.1666666667, 0.6666666667, 0.3333333333},
      {0.0, 0.0, 0.0},
      {0.0, 0.0, 0.0},
      {0.0, 0.0, 0.0},
    },
    { // cubic
      {0.1012865073, 0.1012865073, 0.1259391805},
      {0.7974269854, 0.1012865073, 0.1259391805},
      {0.1012865073, 0.7974269854, 0.1259391805},
      {0.4701420641, 0.0597158718, 0.1323941527},
      {0.4701420641, 0.4701420641, 0.1323941527},
      {0.0597158718, 0.4701420641, 0.1323941527},
      {0.3333333333, 0.3333333333, 0.225},
    }
  };

// ============================

constexpr static unsigned int NIntTetGauss[4] = {
  1, 4, 5, 16
};

template<typename T>
constexpr static T TetGauss[4][16][4] = {
  {    // order-1    1point
    {0.25, 0.25, 0.25, 1.0},
  },
  {    // order-2    4point
    {0.585410196624968, 0.138196601125015, 0.138196601125015, 0.25},
    {0.138196601125015, 0.585410196624968, 0.138196601125015, 0.25},
    {0.138196601125015, 0.138196601125015, 0.585410196624968, 0.25},
    {0.138196601125015, 0.138196601125015, 0.138196601125015, 0.25},
  },
  {    // order-3    5point
    {0.25, 0.25, 0.25, -0.8},
    {0.5, 0.1666666666666667, 0.1666666666666667, 0.45},
    {0.1666666666666667, 0.5, 0.1666666666666667, 0.45},
    {0.1666666666666667, 0.1666666666666667, 0.5, 0.45},
    {0.1666666666666667, 0.1666666666666667, 0.1666666666666667, 0.45},
  },
  {    // order-4    16point
    {0.7716429020672371, 0.07611903264425430, 0.07611903264425430, 0.05037379410012282},
    {0.07611903264425430, 0.7716429020672371, 0.07611903264425430, 0.05037379410012282},
    {0.07611903264425430, 0.07611903264425430, 0.7716429020672371, 0.05037379410012282},
    {0.07611903264425430, 0.07611903264425430, 0.07611903264425430, 0.05037379410012282},

    {0.1197005277978019, 0.4042339134672644, 0.4042339134672644, 0.06654206863329239},
    {0.4042339134672644, 0.1197005277978019, 0.4042339134672644, 0.06654206863329239},
    {0.4042339134672644, 0.4042339134672644, 0.1197005277978019, 0.06654206863329239},

    {0.07183164526766925, 0.4042339134672644, 0.4042339134672644, 0.06654206863329239},
    {0.4042339134672644, 0.07183164526766925, 0.4042339134672644, 0.06654206863329239},
    {0.4042339134672644, 0.4042339134672644, 0.07183164526766925, 0.06654206863329239},

    {0.1197005277978019, 0.07183164526766925, 0.4042339134672644, 0.06654206863329239},
    {0.4042339134672644, 0.1197005277978019, 0.07183164526766925, 0.06654206863329239},
    {0.07183164526766925, 0.4042339134672644, 0.1197005277978019, 0.06654206863329239},

    {0.07183164526766925, 0.1197005277978019, 0.4042339134672644, 0.06654206863329239},
    {0.4042339134672644, 0.07183164526766925, 0.1197005277978019, 0.06654206863329239},
    {0.1197005277978019, 0.4042339134672644, 0.07183164526766925, 0.06654206863329239},
  }
};

}

#endif // DFM2_QUADRATURE_H_
